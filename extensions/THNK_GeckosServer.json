{
  "author": "",
  "category": "Network",
  "extensionNamespace": "",
  "fullName": "THNK Framework - Geckos server adapter",
  "helpPath": "https://thnk.cloud/",
  "iconUrl": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLXNlcnZlci1uZXR3b3JrIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTEzLDE5SDE0QTEsMSAwIDAsMSAxNSwyMEgyMlYyMkgxNUExLDEgMCAwLDEgMTQsMjNIMTBBMSwxIDAgMCwxIDksMjJIMlYyMEg5QTEsMSAwIDAsMSAxMCwxOUgxMVYxN0g0QTEsMSAwIDAsMSAzLDE2VjEyQTEsMSAwIDAsMSA0LDExSDIwQTEsMSAwIDAsMSAyMSwxMlYxNkExLDEgMCAwLDEgMjAsMTdIMTNWMTlNNCwzSDIwQTEsMSAwIDAsMSAyMSw0VjhBMSwxIDAgMCwxIDIwLDlINEExLDEgMCAwLDEgMyw4VjRBMSwxIDAgMCwxIDQsM005LDdIMTBWNUg5VjdNOSwxNUgxMFYxM0g5VjE1TTUsNVY3SDdWNUg1TTUsMTNWMTVIN1YxM0g1WiIgLz48L3N2Zz4=",
  "name": "THNK_GeckosServer",
  "previewIconUrl": "https://resources.gdevelop-app.com/assets/Icons/server-network.svg",
  "shortDescription": "A THNK adapter to provide a server via geckos.io (IP & Port).",
  "version": "1.0.0",
  "description": [
    "A THNK adapter to provide a server via [geckos.io](https://geckos.io). Geckos servers are bound to the local machine's networking: you connect to one using your machine's IP address and a port number (preferably 4 digits long).",
    "",
    "NOTE: The geckos servers will only work on previews and PC builds. Preview support is currently windows-only."
  ],
  "tags": [
    "THNK",
    "adapter",
    "geckos",
    "IP",
    "port",
    "address",
    "geckos.io"
  ],
  "authorIds": [
    "ZgrsWuRTAkXgeuPV9bo0zuEcA2w1"
  ],
  "dependencies": [
    {
      "exportName": "@geckos.io/server",
      "name": "Geckos server",
      "type": "npm",
      "version": "^2.2.3"
    }
  ],
  "eventsFunctions": [
    {
      "fullName": "",
      "functionType": "Action",
      "name": "onFirstSceneLoaded",
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "// Load THNK Geckos Server Adapter (https://github.com/arthuro555/THNK)\n\"use strict\";var ht=Object.create;var Te=Object.defineProperty;var ut=Object.getOwnPropertyDescriptor;var ft=Object.getOwnPropertyNames;var lt=Object.getPrototypeOf,dt=Object.prototype.hasOwnProperty;var M=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var pt=(r,e,t,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of ft(e))!dt.call(r,i)&&i!==t&&Te(r,i,{get:()=>e[i],enumerable:!(s=ut(e,i))||s.enumerable});return r};var xe=(r,e,t)=>(t=r!=null?ht(lt(r)):{},pt(e||!r||!r.__esModule?Te(t,\"default\",{value:r,enumerable:!0}):t,r));var Ae=M((Kt,Be)=>{var N=require(\"fs\"),Et=require(\"util\"),W=require(\"path\"),_e=require(\"events\"),Ue=require(\"zlib\"),ze=require(\"stream\"),o={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSIGFIRST:80,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,MAXFILECOMMENT:65535,ENDL64HDR:20,ENDL64SIG:117853008,ENDL64SIGFIRST:80,ENDL64OFS:8,END64HDR:56,END64SIG:101075792,END64SIGFIRST:80,END64SUB:24,END64TOT:32,END64SIZ:40,END64OFF:48,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,FLG_ENC:0,FLG_COMP1:1,FLG_COMP2:2,FLG_DESC:4,FLG_ENH:8,FLG_STR:16,FLG_LNG:1024,FLG_MSK:4096,FLG_ENTRY_ENC:1,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535},k=function(r){let e,t,s,i,c,l,p=this,C=r.storeEntries!==!1?{}:null,a=r.file,d=r.nameEncoding?new TextDecoder(r.nameEncoding):null;m();function m(){r.fd?(e=r.fd,S()):N.open(a,\"r\",(n,h)=>{if(n)return p.emit(\"error\",n);e=h,S()})}function S(){N.fstat(e,(n,h)=>{if(n)return p.emit(\"error\",n);t=h.size,s=r.chunkSize||Math.round(t/1e3),s=Math.max(Math.min(s,Math.min(128*1024,t)),Math.min(1024,t)),D()})}function y(n,h){if(n||!h)return p.emit(\"error\",n||new Error(\"Archive read error\"));let f=i.lastPos,u=f-i.win.position,g=i.win.buffer,E=i.minPos;for(;--f>=E&&--u>=0;)if(g.length-u>=4&&g[u]===i.firstByte&&g.readUInt32LE(u)===i.sig){i.lastBufferPosition=u,i.lastBytesRead=h,i.complete();return}if(f===E)return p.emit(\"error\",new Error(\"Bad archive\"));if(i.lastPos=f+1,i.chunkSize*=2,f<=E)return p.emit(\"error\",new Error(\"Bad archive\"));let _=Math.min(i.chunkSize,f-E);i.win.expandLeft(_,y)}function D(){let n=Math.min(o.ENDHDR+o.MAXFILECOMMENT,t);i={win:new oe(e),totalReadLength:n,minPos:t-n,lastPos:t,chunkSize:Math.min(1024,s),firstByte:o.ENDSIGFIRST,sig:o.ENDSIG,complete:L},i.win.read(t-i.chunkSize,i.chunkSize,y)}function L(){let n=i.win.buffer,h=i.lastBufferPosition;try{c=new pe,c.read(n.slice(h,h+o.ENDHDR)),c.headerOffset=i.win.position+h,c.commentLength?p.comment=n.slice(h+o.ENDHDR,h+o.ENDHDR+c.commentLength).toString():p.comment=null,p.entriesCount=c.volumeEntries,p.centralDirectory=c,c.volumeEntries===o.EF_ZIP64_OR_16&&c.totalEntries===o.EF_ZIP64_OR_16||c.size===o.EF_ZIP64_OR_32||c.offset===o.EF_ZIP64_OR_32?T():(i={},P())}catch(f){p.emit(\"error\",f)}}function T(){let n=o.ENDL64HDR;i.lastBufferPosition>n?(i.lastBufferPosition-=n,U()):(i={win:i.win,totalReadLength:n,minPos:i.win.position-n,lastPos:i.win.position,chunkSize:i.chunkSize,firstByte:o.ENDL64SIGFIRST,sig:o.ENDL64SIG,complete:U},i.win.read(i.lastPos-i.chunkSize,i.chunkSize,y))}function U(){let n=i.win.buffer,h=new Ee;h.read(n.slice(i.lastBufferPosition,i.lastBufferPosition+o.ENDL64HDR));let f=t-h.headerOffset;i={win:i.win,totalReadLength:f,minPos:h.headerOffset,lastPos:i.lastPos,chunkSize:i.chunkSize,firstByte:o.END64SIGFIRST,sig:o.END64SIG,complete:J},i.win.read(t-i.chunkSize,i.chunkSize,y)}function J(){let n=i.win.buffer,h=new me;h.read(n.slice(i.lastBufferPosition,i.lastBufferPosition+o.END64HDR)),p.centralDirectory.volumeEntries=h.volumeEntries,p.centralDirectory.totalEntries=h.totalEntries,p.centralDirectory.size=h.size,p.centralDirectory.offset=h.offset,p.entriesCount=h.volumeEntries,i={},P()}function P(){i={win:new oe(e),pos:c.offset,chunkSize:s,entriesLeft:c.volumeEntries},i.win.read(i.pos,Math.min(s,t-i.pos),le)}function le(n,h){if(n||!h)return p.emit(\"error\",n||new Error(\"Entries read error\"));let f=i.pos-i.win.position,u=i.entry,g=i.win.buffer,E=g.length;try{for(;i.entriesLeft>0;){u||(u=new Ce,u.readHeader(g,f),u.headerOffset=i.win.position+f,i.entry=u,i.pos+=o.CENHDR,f+=o.CENHDR);let _=u.fnameLen+u.extraLen+u.comLen,v=_+(i.entriesLeft>1?o.CENHDR:0);if(E-f<v){i.win.moveRight(s,le,f),i.move=!0;return}u.read(g,f,d),r.skipEntryNameValidation||u.validateName(),C&&(C[u.name]=u),p.emit(\"entry\",u),i.entry=u=null,i.entriesLeft--,i.pos+=_,f+=_}p.emit(\"ready\")}catch(_){p.emit(\"error\",_)}}function Z(){if(!C)throw new Error(\"storeEntries disabled\")}Object.defineProperty(this,\"ready\",{get(){return!1}}),this.entry=function(n){return Z(),C[n]},this.entries=function(){return Z(),C},this.stream=function(n,h){return this.openEntry(n,(f,u)=>{if(f)return h(f);let g=ne(u),E=new ge(e,g,u.compressedSize);if(u.method!==o.STORED)if(u.method===o.DEFLATED)E=E.pipe(Ue.createInflateRaw());else return h(new Error(\"Unknown compression method: \"+u.method));Q(u)&&(E=E.pipe(new we(E,u.crc,u.size))),h(null,E)},!1)},this.entryDataSync=function(n){let h=null;if(this.openEntry(n,(u,g)=>{h=u,n=g},!0),h)throw h;let f=Buffer.alloc(n.compressedSize);if(new A(e,f,0,n.compressedSize,ne(n),u=>{h=u}).read(!0),h)throw h;if(n.method!==o.STORED)if(n.method===o.DEFLATED||n.method===o.ENHANCED_DEFLATED)f=Ue.inflateRawSync(f);else throw new Error(\"Unknown compression method: \"+n.method);if(f.length!==n.size)throw new Error(\"Invalid size\");return Q(n)&&new q(n.crc,n.size).data(f),f},this.openEntry=function(n,h,f){if(typeof n==\"string\"&&(Z(),n=C[n],!n))return h(new Error(\"Entry not found\"));if(!n.isFile)return h(new Error(\"Entry is not file\"));if(!e)return h(new Error(\"Archive closed\"));let u=Buffer.alloc(o.LOCHDR);new A(e,u,0,u.length,n.offset,g=>{if(g)return h(g);let E;try{n.readDataHeader(u),n.encrypted&&(E=new Error(\"Entry encrypted\"))}catch(_){E=_}h(E,n)}).read(f)};function ne(n){return n.offset+o.LOCHDR+n.fnameLen+n.extraLen}function Q(n){return(n.flags&8)!==8}function ee(n,h,f){p.stream(n,(u,g)=>{if(u)f(u);else{let E,_;g.on(\"error\",v=>{_=v,E&&(g.unpipe(E),E.close(()=>{f(v)}))}),N.open(h,\"w\",(v,x)=>{if(v)return f(v);if(_){N.close(e,()=>{f(_)});return}E=N.createWriteStream(h,{fd:x}),E.on(\"finish\",()=>{p.emit(\"extract\",n,h),_||f()}),g.pipe(E)})}})}function Ne(n,h,f){if(!h.length)return f();let u=h.shift();u=W.join(n,W.join(...u)),N.mkdir(u,{recursive:!0},g=>{if(g&&g.code!==\"EEXIST\")return f(g);Ne(n,h,f)})}function de(n,h,f,u,g){if(!f.length)return u(null,g);let E=f.shift(),_=W.join(n,E.name.replace(h,\"\"));ee(E,_,v=>{if(v)return u(v,g);de(n,h,f,u,g+1)})}this.extract=function(n,h,f){let u=n||\"\";if(typeof n==\"string\"&&(n=this.entry(n),n?u=n.name:u.length&&u[u.length-1]!==\"/\"&&(u+=\"/\")),!n||n.isDirectory){let g=[],E=[],_={};for(let v in C)if(Object.prototype.hasOwnProperty.call(C,v)&&v.lastIndexOf(u,0)===0){let x=v.replace(u,\"\"),be=C[v];if(be.isFile&&(g.push(be),x=W.dirname(x)),x&&!_[x]&&x!==\".\"){_[x]=!0;let z=x.split(\"/\").filter(te=>te);for(z.length&&E.push(z);z.length>1;){z=z.slice(0,z.length-1);let te=z.join(\"/\");if(_[te]||te===\".\")break;_[te]=!0,E.push(z)}}}E.sort((v,x)=>v.length-x.length),E.length?Ne(h,E,v=>{v?f(v):de(h,u,g,f,0)}):de(h,u,g,f,0)}else N.stat(h,(g,E)=>{E&&E.isDirectory()?ee(n,W.join(h,W.basename(n.name)),f):ee(n,h,f)})},this.close=function(n){l||!e?(l=!0,n&&n()):(l=!0,N.close(e,h=>{e=null,n&&n(h)}))};let at=_e.EventEmitter.prototype.emit;this.emit=function(...n){if(!l)return at.call(this,...n)}};k.setFs=function(r){N=r};k.debugLog=(...r)=>{k.debug&&console.log(...r)};Et.inherits(k,_e.EventEmitter);var B=Symbol(\"zip\");k.async=class extends _e.EventEmitter{constructor(e){super();let t=new k(e);t.on(\"entry\",s=>this.emit(\"entry\",s)),t.on(\"extract\",(s,i)=>this.emit(\"extract\",s,i)),this[B]=new Promise((s,i)=>{t.on(\"ready\",()=>{t.removeListener(\"error\",i),s(t)}),t.on(\"error\",i)})}get entriesCount(){return this[B].then(e=>e.entriesCount)}get comment(){return this[B].then(e=>e.comment)}async entry(e){return(await this[B]).entry(e)}async entries(){return(await this[B]).entries()}async stream(e){let t=await this[B];return new Promise((s,i)=>{t.stream(e,(c,l)=>{c?i(c):s(l)})})}async entryData(e){let t=await this.stream(e);return new Promise((s,i)=>{let c=[];t.on(\"data\",l=>c.push(l)),t.on(\"end\",()=>{s(Buffer.concat(c))}),t.on(\"error\",l=>{t.removeAllListeners(\"end\"),i(l)})})}async extract(e,t){let s=await this[B];return new Promise((i,c)=>{s.extract(e,t,(l,w)=>{l?c(l):i(w)})})}async close(){let e=await this[B];return new Promise((t,s)=>{e.close(i=>{i?s(i):t()})})}};var pe=class{read(e){if(e.length!==o.ENDHDR||e.readUInt32LE(0)!==o.ENDSIG)throw new Error(\"Invalid central directory\");this.volumeEntries=e.readUInt16LE(o.ENDSUB),this.totalEntries=e.readUInt16LE(o.ENDTOT),this.size=e.readUInt32LE(o.ENDSIZ),this.offset=e.readUInt32LE(o.ENDOFF),this.commentLength=e.readUInt16LE(o.ENDCOM)}},Ee=class{read(e){if(e.length!==o.ENDL64HDR||e.readUInt32LE(0)!==o.ENDL64SIG)throw new Error(\"Invalid zip64 central directory locator\");this.headerOffset=G(e,o.ENDSUB)}},me=class{read(e){if(e.length!==o.END64HDR||e.readUInt32LE(0)!==o.END64SIG)throw new Error(\"Invalid central directory\");this.volumeEntries=G(e,o.END64SUB),this.totalEntries=G(e,o.END64TOT),this.size=G(e,o.END64SIZ),this.offset=G(e,o.END64OFF)}},Ce=class{readHeader(e,t){if(e.length<t+o.CENHDR||e.readUInt32LE(t)!==o.CENSIG)throw new Error(\"Invalid entry header\");this.verMade=e.readUInt16LE(t+o.CENVEM),this.version=e.readUInt16LE(t+o.CENVER),this.flags=e.readUInt16LE(t+o.CENFLG),this.method=e.readUInt16LE(t+o.CENHOW);let s=e.readUInt16LE(t+o.CENTIM),i=e.readUInt16LE(t+o.CENTIM+2);this.time=Me(s,i),this.crc=e.readUInt32LE(t+o.CENCRC),this.compressedSize=e.readUInt32LE(t+o.CENSIZ),this.size=e.readUInt32LE(t+o.CENLEN),this.fnameLen=e.readUInt16LE(t+o.CENNAM),this.extraLen=e.readUInt16LE(t+o.CENEXT),this.comLen=e.readUInt16LE(t+o.CENCOM),this.diskStart=e.readUInt16LE(t+o.CENDSK),this.inattr=e.readUInt16LE(t+o.CENATT),this.attr=e.readUInt32LE(t+o.CENATX),this.offset=e.readUInt32LE(t+o.CENOFF)}readDataHeader(e){if(e.readUInt32LE(0)!==o.LOCSIG)throw new Error(\"Invalid local header\");this.version=e.readUInt16LE(o.LOCVER),this.flags=e.readUInt16LE(o.LOCFLG),this.method=e.readUInt16LE(o.LOCHOW);let t=e.readUInt16LE(o.LOCTIM),s=e.readUInt16LE(o.LOCTIM+2);this.time=Me(t,s),this.crc=e.readUInt32LE(o.LOCCRC)||this.crc;let i=e.readUInt32LE(o.LOCSIZ);i&&i!==o.EF_ZIP64_OR_32&&(this.compressedSize=i);let c=e.readUInt32LE(o.LOCLEN);c&&c!==o.EF_ZIP64_OR_32&&(this.size=c),this.fnameLen=e.readUInt16LE(o.LOCNAM),this.extraLen=e.readUInt16LE(o.LOCEXT)}read(e,t,s){let i=e.slice(t,t+=this.fnameLen);this.name=s?s.decode(new Uint8Array(i)):i.toString(\"utf8\");let c=e[t-1];this.isDirectory=c===47||c===92,this.extraLen&&(this.readExtra(e,t),t+=this.extraLen),this.comment=this.comLen?e.slice(t,t+this.comLen).toString():null}validateName(){if(/\\\\|^\\w+:|^\\/|(^|\\/)\\.\\.(\\/|$)/.test(this.name))throw new Error(\"Malicious entry: \"+this.name)}readExtra(e,t){let s,i,c=t+this.extraLen;for(;t<c;)s=e.readUInt16LE(t),t+=2,i=e.readUInt16LE(t),t+=2,o.ID_ZIP64===s&&this.parseZip64Extra(e,t,i),t+=i}parseZip64Extra(e,t,s){s>=8&&this.size===o.EF_ZIP64_OR_32&&(this.size=G(e,t),t+=8,s-=8),s>=8&&this.compressedSize===o.EF_ZIP64_OR_32&&(this.compressedSize=G(e,t),t+=8,s-=8),s>=8&&this.offset===o.EF_ZIP64_OR_32&&(this.offset=G(e,t),t+=8,s-=8),s>=4&&this.diskStart===o.EF_ZIP64_OR_16&&(this.diskStart=e.readUInt32LE(t))}get encrypted(){return(this.flags&o.FLG_ENTRY_ENC)===o.FLG_ENTRY_ENC}get isFile(){return!this.isDirectory}},A=class{constructor(e,t,s,i,c,l){this.fd=e,this.buffer=t,this.offset=s,this.length=i,this.position=c,this.callback=l,this.bytesRead=0,this.waiting=!1}read(e){k.debugLog(\"read\",this.position,this.bytesRead,this.length,this.offset),this.waiting=!0;let t;if(e){let s=0;try{s=N.readSync(this.fd,this.buffer,this.offset+this.bytesRead,this.length-this.bytesRead,this.position+this.bytesRead)}catch(i){t=i}this.readCallback(e,t,t?s:null)}else N.read(this.fd,this.buffer,this.offset+this.bytesRead,this.length-this.bytesRead,this.position+this.bytesRead,this.readCallback.bind(this,e))}readCallback(e,t,s){if(typeof s==\"number\"&&(this.bytesRead+=s),t||!s||this.bytesRead===this.length)return this.waiting=!1,this.callback(t,this.bytesRead);this.read(e)}},oe=class{constructor(e){this.position=0,this.buffer=Buffer.alloc(0),this.fd=e,this.fsOp=null}checkOp(){if(this.fsOp&&this.fsOp.waiting)throw new Error(\"Operation in progress\")}read(e,t,s){this.checkOp(),this.buffer.length<t&&(this.buffer=Buffer.alloc(t)),this.position=e,this.fsOp=new A(this.fd,this.buffer,0,t,this.position,s).read()}expandLeft(e,t){this.checkOp(),this.buffer=Buffer.concat([Buffer.alloc(e),this.buffer]),this.position-=e,this.position<0&&(this.position=0),this.fsOp=new A(this.fd,this.buffer,0,e,this.position,t).read()}expandRight(e,t){this.checkOp();let s=this.buffer.length;this.buffer=Buffer.concat([this.buffer,Buffer.alloc(e)]),this.fsOp=new A(this.fd,this.buffer,s,e,this.position+s,t).read()}moveRight(e,t,s){this.checkOp(),s?this.buffer.copy(this.buffer,0,s):s=0,this.position+=s,this.fsOp=new A(this.fd,this.buffer,this.buffer.length-s,s,this.position+this.buffer.length-s,t).read()}},ge=class extends ze.Readable{constructor(e,t,s){super(),this.fd=e,this.offset=t,this.length=s,this.pos=0,this.readCallback=this.readCallback.bind(this)}_read(e){let t=Buffer.alloc(Math.min(e,this.length-this.pos));t.length?N.read(this.fd,t,0,t.length,this.offset+this.pos,this.readCallback):this.push(null)}readCallback(e,t,s){this.pos+=t,e?(this.emit(\"error\",e),this.push(null)):t?(t!==s.length&&(s=s.slice(0,t)),this.push(s)):this.push(null)}},we=class extends ze.Transform{constructor(e,t,s){super(),this.verify=new q(t,s),e.on(\"error\",i=>{this.emit(\"error\",i)})}_transform(e,t,s){let i;try{this.verify.data(e)}catch(c){i=c}s(i,e)}},q=class{constructor(e,t){this.crc=e,this.size=t,this.state={crc:-1,size:0}}data(e){let t=q.getCrcTable(),s=this.state.crc,i=0,c=e.length;for(;--c>=0;)s=t[(s^e[i++])&255]^s>>>8;if(this.state.crc=s,this.state.size+=e.length,this.state.size>=this.size){let l=Buffer.alloc(4);if(l.writeInt32LE(~this.state.crc&4294967295,0),s=l.readUInt32LE(0),s!==this.crc)throw new Error(\"Invalid CRC\");if(this.state.size!==this.size)throw new Error(\"Invalid size\")}}static getCrcTable(){let e=q.crcTable;if(!e){q.crcTable=e=[];let t=Buffer.alloc(4);for(let s=0;s<256;s++){let i=s;for(let c=8;--c>=0;)(i&1)!==0?i=3988292384^i>>>1:i=i>>>1;i<0&&(t.writeInt32LE(i,0),i=t.readUInt32LE(0)),e[s]=i}}return e}};function Me(r,e){let t=Pe(r,16),s=Pe(e,16),i={h:parseInt(t.slice(0,5).join(\"\"),2),m:parseInt(t.slice(5,11).join(\"\"),2),s:parseInt(t.slice(11,16).join(\"\"),2)*2,Y:parseInt(s.slice(0,7).join(\"\"),2)+1980,M:parseInt(s.slice(7,11).join(\"\"),2),D:parseInt(s.slice(11,16).join(\"\"),2)},c=[i.Y,i.M,i.D].join(\"-\")+\" \"+[i.h,i.m,i.s].join(\":\")+\" GMT+0\";return new Date(c).getTime()}function Pe(r,e){let t=(r>>>0).toString(2);for(;t.length<e;)t=\"0\"+t;return t.split(\"\")}function G(r,e){return r.readUInt32LE(e+4)*4294967296+r.readUInt32LE(e)}Be.exports=k});var qe=M((Vt,Ge)=>{var K=1e3,V=K*60,Y=V*60,j=Y*24,mt=j*7,Ct=j*365.25;Ge.exports=function(r,e){e=e||{};var t=typeof r;if(t===\"string\"&&r.length>0)return gt(r);if(t===\"number\"&&isFinite(r))return e.long?_t(r):wt(r);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(r))};function gt(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!!e){var t=parseFloat(e[1]),s=(e[2]||\"ms\").toLowerCase();switch(s){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return t*Ct;case\"weeks\":case\"week\":case\"w\":return t*mt;case\"days\":case\"day\":case\"d\":return t*j;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return t*Y;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return t*V;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return t*K;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return t;default:return}}}}function wt(r){var e=Math.abs(r);return e>=j?Math.round(r/j)+\"d\":e>=Y?Math.round(r/Y)+\"h\":e>=V?Math.round(r/V)+\"m\":e>=K?Math.round(r/K)+\"s\":r+\"ms\"}function _t(r){var e=Math.abs(r);return e>=j?ce(r,e,j,\"day\"):e>=Y?ce(r,e,Y,\"hour\"):e>=V?ce(r,e,V,\"minute\"):e>=K?ce(r,e,K,\"second\"):r+\" ms\"}function ce(r,e,t,s){var i=e>=t*1.5;return Math.round(r/t)+\" \"+s+(i?\"s\":\"\")}});var ve=M((Yt,ke)=>{function vt(r){t.debug=t,t.default=t,t.coerce=p,t.disable=c,t.enable=i,t.enabled=l,t.humanize=qe(),t.destroy=C,Object.keys(r).forEach(a=>{t[a]=r[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let d=0;for(let m=0;m<a.length;m++)d=(d<<5)-d+a.charCodeAt(m),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(a){let d,m=null,S,y;function D(...L){if(!D.enabled)return;let T=D,U=Number(new Date),J=U-(d||U);T.diff=J,T.prev=d,T.curr=U,d=U,L[0]=t.coerce(L[0]),typeof L[0]!=\"string\"&&L.unshift(\"%O\");let P=0;L[0]=L[0].replace(/%([a-zA-Z%])/g,(Z,ne)=>{if(Z===\"%%\")return\"%\";P++;let Q=t.formatters[ne];if(typeof Q==\"function\"){let ee=L[P];Z=Q.call(T,ee),L.splice(P,1),P--}return Z}),t.formatArgs.call(T,L),(T.log||t.log).apply(T,L)}return D.namespace=a,D.useColors=t.useColors(),D.color=t.selectColor(a),D.extend=s,D.destroy=t.destroy,Object.defineProperty(D,\"enabled\",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(S!==t.namespaces&&(S=t.namespaces,y=t.enabled(a)),y),set:L=>{m=L}}),typeof t.init==\"function\"&&t.init(D),D}function s(a,d){let m=t(this.namespace+(typeof d>\"u\"?\":\":d)+a);return m.log=this.log,m}function i(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let d,m=(typeof a==\"string\"?a:\"\").split(/[\\s,]+/),S=m.length;for(d=0;d<S;d++)!m[d]||(a=m[d].replace(/\\*/g,\".*?\"),a[0]===\"-\"?t.skips.push(new RegExp(\"^\"+a.slice(1)+\"$\")):t.names.push(new RegExp(\"^\"+a+\"$\")))}function c(){let a=[...t.names.map(w),...t.skips.map(w).map(d=>\"-\"+d)].join(\",\");return t.enable(\"\"),a}function l(a){if(a[a.length-1]===\"*\")return!0;let d,m;for(d=0,m=t.skips.length;d<m;d++)if(t.skips[d].test(a))return!1;for(d=0,m=t.names.length;d<m;d++)if(t.names[d].test(a))return!0;return!1}function w(a){return a.toString().substring(2,a.toString().length-2).replace(/\\.\\*\\?$/,\"*\")}function p(a){return a instanceof Error?a.stack||a.message:a}function C(){console.warn(\"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.\")}return t.enable(t.load()),t}ke.exports=vt});var He=M((F,ae)=>{F.formatArgs=Lt;F.save=Rt;F.load=yt;F.useColors=It;F.storage=Dt();F.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn(\"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.\"))}})();F.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"];function It(){return typeof window<\"u\"&&window.process&&(window.process.type===\"renderer\"||window.process.__nwjs)?!0:typeof navigator<\"u\"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)?!1:typeof document<\"u\"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<\"u\"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<\"u\"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<\"u\"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)}function Lt(r){if(r[0]=(this.useColors?\"%c\":\"\")+this.namespace+(this.useColors?\" %c\":\" \")+r[0]+(this.useColors?\"%c \":\" \")+\"+\"+ae.exports.humanize(this.diff),!this.useColors)return;let e=\"color: \"+this.color;r.splice(1,0,e,\"color: inherit\");let t=0,s=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!==\"%%\"&&(t++,i===\"%c\"&&(s=t))}),r.splice(s,0,e)}F.log=console.debug||console.log||(()=>{});function Rt(r){try{r?F.storage.setItem(\"debug\",r):F.storage.removeItem(\"debug\")}catch{}}function yt(){let r;try{r=F.storage.getItem(\"debug\")}catch{}return!r&&typeof process<\"u\"&&\"env\"in process&&(r=process.env.DEBUG),r}function Dt(){try{return localStorage}catch{}}ae.exports=ve()(F);var{formatters:Ft}=ae.exports;Ft.j=function(r){try{return JSON.stringify(r)}catch(e){return\"[UnexpectedJSONParseError]: \"+e.message}}});var je=M((Jt,Ze)=>{\"use strict\";Ze.exports=(r,e=process.argv)=>{let t=r.startsWith(\"-\")?\"\":r.length===1?\"-\":\"--\",s=e.indexOf(t+r),i=e.indexOf(\"--\");return s!==-1&&(i===-1||s<i)}});var We=M((Qt,$e)=>{\"use strict\";var Ot=require(\"os\"),Xe=require(\"tty\"),b=je(),{env:I}=process,H;b(\"no-color\")||b(\"no-colors\")||b(\"color=false\")||b(\"color=never\")?H=0:(b(\"color\")||b(\"colors\")||b(\"color=true\")||b(\"color=always\"))&&(H=1);\"FORCE_COLOR\"in I&&(I.FORCE_COLOR===\"true\"?H=1:I.FORCE_COLOR===\"false\"?H=0:H=I.FORCE_COLOR.length===0?1:Math.min(parseInt(I.FORCE_COLOR,10),3));function Ie(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function Le(r,e){if(H===0)return 0;if(b(\"color=16m\")||b(\"color=full\")||b(\"color=truecolor\"))return 3;if(b(\"color=256\"))return 2;if(r&&!e&&H===void 0)return 0;let t=H||0;if(I.TERM===\"dumb\")return t;if(process.platform===\"win32\"){let s=Ot.release().split(\".\");return Number(s[0])>=10&&Number(s[2])>=10586?Number(s[2])>=14931?3:2:1}if(\"CI\"in I)return[\"TRAVIS\",\"CIRCLECI\",\"APPVEYOR\",\"GITLAB_CI\",\"GITHUB_ACTIONS\",\"BUILDKITE\"].some(s=>s in I)||I.CI_NAME===\"codeship\"?1:t;if(\"TEAMCITY_VERSION\"in I)return/^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(I.TEAMCITY_VERSION)?1:0;if(I.COLORTERM===\"truecolor\")return 3;if(\"TERM_PROGRAM\"in I){let s=parseInt((I.TERM_PROGRAM_VERSION||\"\").split(\".\")[0],10);switch(I.TERM_PROGRAM){case\"iTerm.app\":return s>=3?3:2;case\"Apple_Terminal\":return 2}}return/-256(color)?$/i.test(I.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(I.TERM)||\"COLORTERM\"in I?1:t}function St(r){let e=Le(r,r&&r.isTTY);return Ie(e)}$e.exports={supportsColor:St,stdout:Ie(Le(!0,Xe.isatty(1))),stderr:Ie(Le(!0,Xe.isatty(2)))}});var Ve=M((R,ue)=>{var Nt=require(\"tty\"),he=require(\"util\");R.init=zt;R.log=Ut;R.formatArgs=Tt;R.save=Mt;R.load=Pt;R.useColors=bt;R.destroy=he.deprecate(()=>{},\"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.\");R.colors=[6,2,3,4,5,1];try{let r=We();r&&(r.stderr||r).level>=2&&(R.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}R.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,c)=>c.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s===\"null\"?s=null:s=Number(s),r[t]=s,r},{});function bt(){return\"colors\"in R.inspectOpts?Boolean(R.inspectOpts.colors):Nt.isatty(process.stderr.fd)}function Tt(r){let{namespace:e,useColors:t}=this;if(t){let s=this.color,i=\"\\x1B[3\"+(s<8?s:\"8;5;\"+s),c=`  ${i};1m${e} \\x1B[0m`;r[0]=c+r[0].split(`\n`).join(`\n`+c),r.push(i+\"m+\"+ue.exports.humanize(this.diff)+\"\\x1B[0m\")}else r[0]=xt()+e+\" \"+r[0]}function xt(){return R.inspectOpts.hideDate?\"\":new Date().toISOString()+\" \"}function Ut(...r){return process.stderr.write(he.format(...r)+`\n`)}function Mt(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Pt(){return process.env.DEBUG}function zt(r){r.inspectOpts={};let e=Object.keys(R.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=R.inspectOpts[e[t]]}ue.exports=ve()(R);var{formatters:Ke}=ue.exports;Ke.o=function(r){return this.inspectOpts.colors=this.useColors,he.inspect(r,this.inspectOpts).split(`\n`).map(e=>e.trim()).join(\" \")};Ke.O=function(r){return this.inspectOpts.colors=this.useColors,he.inspect(r,this.inspectOpts)}});var Ye=M((er,Re)=>{typeof process>\"u\"||process.type===\"renderer\"||process.browser===!0||process.__nwjs?Re.exports=He():Re.exports=Ve()});var Qe=M((tr,Je)=>{var re;Je.exports=function(){if(!re){try{re=Ye()(\"follow-redirects\")}catch{}typeof re!=\"function\"&&(re=function(){})}re.apply(null,arguments)}});var ct=M((rr,Se)=>{var X=require(\"url\"),ye=X.URL,Bt=require(\"http\"),At=require(\"https\"),rt=require(\"stream\").Writable,st=require(\"assert\"),it=Qe(),Fe=[\"abort\",\"aborted\",\"connect\",\"error\",\"socket\",\"timeout\"],Oe=Object.create(null);Fe.forEach(function(r){Oe[r]=function(e,t,s){this._redirectable.emit(r,e,t,s)}});var Gt=ie(\"ERR_INVALID_URL\",\"Invalid URL\",TypeError),et=ie(\"ERR_FR_REDIRECTION_FAILURE\",\"Redirected request failed\"),qt=ie(\"ERR_FR_TOO_MANY_REDIRECTS\",\"Maximum number of redirects exceeded\"),kt=ie(\"ERR_FR_MAX_BODY_LENGTH_EXCEEDED\",\"Request body larger than maxBodyLength limit\"),Ht=ie(\"ERR_STREAM_WRITE_AFTER_END\",\"write after end\");function O(r,e){rt.call(this),this._sanitizeOptions(r),this._options=r,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],e&&this.on(\"response\",e);var t=this;this._onNativeResponse=function(s){t._processResponse(s)},this._performRequest()}O.prototype=Object.create(rt.prototype);O.prototype.abort=function(){ot(this._currentRequest),this.emit(\"abort\")};O.prototype.write=function(r,e,t){if(this._ending)throw new Ht;if(!$(r)&&!Xt(r))throw new TypeError(\"data should be a string, Buffer or Uint8Array\");if(se(e)&&(t=e,e=null),r.length===0){t&&t();return}this._requestBodyLength+r.length<=this._options.maxBodyLength?(this._requestBodyLength+=r.length,this._requestBodyBuffers.push({data:r,encoding:e}),this._currentRequest.write(r,e,t)):(this.emit(\"error\",new kt),this.abort())};O.prototype.end=function(r,e,t){if(se(r)?(t=r,r=e=null):se(e)&&(t=e,e=null),!r)this._ended=this._ending=!0,this._currentRequest.end(null,null,t);else{var s=this,i=this._currentRequest;this.write(r,e,function(){s._ended=!0,i.end(null,null,t)}),this._ending=!0}};O.prototype.setHeader=function(r,e){this._options.headers[r]=e,this._currentRequest.setHeader(r,e)};O.prototype.removeHeader=function(r){delete this._options.headers[r],this._currentRequest.removeHeader(r)};O.prototype.setTimeout=function(r,e){var t=this;function s(l){l.setTimeout(r),l.removeListener(\"timeout\",l.destroy),l.addListener(\"timeout\",l.destroy)}function i(l){t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){t.emit(\"timeout\"),c()},r),s(l)}function c(){t._timeout&&(clearTimeout(t._timeout),t._timeout=null),t.removeListener(\"abort\",c),t.removeListener(\"error\",c),t.removeListener(\"response\",c),e&&t.removeListener(\"timeout\",e),t.socket||t._currentRequest.removeListener(\"socket\",i)}return e&&this.on(\"timeout\",e),this.socket?i(this.socket):this._currentRequest.once(\"socket\",i),this.on(\"socket\",s),this.on(\"abort\",c),this.on(\"error\",c),this.on(\"response\",c),this};[\"flushHeaders\",\"getHeader\",\"setNoDelay\",\"setSocketKeepAlive\"].forEach(function(r){O.prototype[r]=function(e,t){return this._currentRequest[r](e,t)}});[\"aborted\",\"connection\",\"socket\"].forEach(function(r){Object.defineProperty(O.prototype,r,{get:function(){return this._currentRequest[r]}})});O.prototype._sanitizeOptions=function(r){if(r.headers||(r.headers={}),r.host&&(r.hostname||(r.hostname=r.host),delete r.host),!r.pathname&&r.path){var e=r.path.indexOf(\"?\");e<0?r.pathname=r.path:(r.pathname=r.path.substring(0,e),r.search=r.path.substring(e))}};O.prototype._performRequest=function(){var r=this._options.protocol,e=this._options.nativeProtocols[r];if(!e){this.emit(\"error\",new TypeError(\"Unsupported protocol \"+r));return}if(this._options.agents){var t=r.slice(0,-1);this._options.agent=this._options.agents[t]}var s=this._currentRequest=e.request(this._options,this._onNativeResponse);s._redirectable=this;for(var i of Fe)s.on(i,Oe[i]);if(this._currentUrl=/^\\//.test(this._options.path)?X.format(this._options):this._options.path,this._isRedirect){var c=0,l=this,w=this._requestBodyBuffers;(function p(C){if(s===l._currentRequest)if(C)l.emit(\"error\",C);else if(c<w.length){var a=w[c++];s.finished||s.write(a.data,a.encoding,p)}else l._ended&&s.end()})()}};O.prototype._processResponse=function(r){var e=r.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:r.headers,statusCode:e});var t=r.headers.location;if(!t||this._options.followRedirects===!1||e<300||e>=400){r.responseUrl=this._currentUrl,r.redirects=this._redirects,this.emit(\"response\",r),this._requestBodyBuffers=[];return}if(ot(this._currentRequest),r.destroy(),++this._redirectCount>this._options.maxRedirects){this.emit(\"error\",new qt);return}var s,i=this._options.beforeRedirect;i&&(s=Object.assign({Host:r.req.getHeader(\"host\")},this._options.headers));var c=this._options.method;((e===301||e===302)&&this._options.method===\"POST\"||e===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method=\"GET\",this._requestBodyBuffers=[],De(/^content-/i,this._options.headers));var l=De(/^host$/i,this._options.headers),w=X.parse(this._currentUrl),p=l||w.host,C=/^\\w+:/.test(t)?this._currentUrl:X.format(Object.assign(w,{host:p})),a;try{a=X.resolve(C,t)}catch(y){this.emit(\"error\",new et({cause:y}));return}it(\"redirecting to\",a),this._isRedirect=!0;var d=X.parse(a);if(Object.assign(this._options,d),(d.protocol!==w.protocol&&d.protocol!==\"https:\"||d.host!==p&&!jt(d.host,p))&&De(/^(?:authorization|cookie)$/i,this._options.headers),se(i)){var m={headers:r.headers,statusCode:e},S={url:C,method:c,headers:s};try{i(this._options,m,S)}catch(y){this.emit(\"error\",y);return}this._sanitizeOptions(this._options)}try{this._performRequest()}catch(y){this.emit(\"error\",new et({cause:y}))}};function nt(r){var e={maxRedirects:21,maxBodyLength:10485760},t={};return Object.keys(r).forEach(function(s){var i=s+\":\",c=t[i]=r[s],l=e[s]=Object.create(c);function w(C,a,d){if($(C)){var m;try{m=tt(new ye(C))}catch{m=X.parse(C)}if(!$(m.protocol))throw new Gt({input:C});C=m}else ye&&C instanceof ye?C=tt(C):(d=a,a=C,C={protocol:i});return se(a)&&(d=a,a=null),a=Object.assign({maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},C,a),a.nativeProtocols=t,!$(a.host)&&!$(a.hostname)&&(a.hostname=\"::1\"),st.equal(a.protocol,i,\"protocol mismatch\"),it(\"options\",a),new O(a,d)}function p(C,a,d){var m=l.request(C,a,d);return m.end(),m}Object.defineProperties(l,{request:{value:w,configurable:!0,enumerable:!0,writable:!0},get:{value:p,configurable:!0,enumerable:!0,writable:!0}})}),e}function Zt(){}function tt(r){var e={protocol:r.protocol,hostname:r.hostname.startsWith(\"[\")?r.hostname.slice(1,-1):r.hostname,hash:r.hash,search:r.search,pathname:r.pathname,path:r.pathname+r.search,href:r.href};return r.port!==\"\"&&(e.port=Number(r.port)),e}function De(r,e){var t;for(var s in e)r.test(s)&&(t=e[s],delete e[s]);return t===null||typeof t>\"u\"?void 0:String(t).trim()}function ie(r,e,t){function s(i){Error.captureStackTrace(this,this.constructor),Object.assign(this,i||{}),this.code=r,this.message=this.cause?e+\": \"+this.cause.message:e}return s.prototype=new(t||Error),s.prototype.constructor=s,s.prototype.name=\"Error [\"+r+\"]\",s}function ot(r){for(var e of Fe)r.removeListener(e,Oe[e]);r.on(\"error\",Zt),r.abort()}function jt(r,e){st($(r)&&$(e));var t=r.length-e.length-1;return t>0&&r[t]===\".\"&&r.endsWith(e)}function $(r){return typeof r==\"string\"||r instanceof String}function se(r){return typeof r==\"function\"}function Xt(r){return typeof r==\"object\"&&\"length\"in r}Se.exports=nt({http:Bt,https:At});Se.exports.wrap=nt});var fe=()=>Math.random().toFixed(Math.ceil(Math.random()*6)+2).slice(2);THNK.GeckosServerAdapter=class extends THNK.ServerAdapter{port;id=0;server=null;httpServer=null;channels=new Map;serverID=`${fe()}-server-${fe()}`;constructor(e){super(),this.port=e}async prepare(e){let t=e.getGame().getRenderer().getElectronRemote();if(!t)throw new Error(\"The game does not seem to be running on a desktop, impossible to launch geckos server!\");let s=t.require,i;if(!e.getGame().isPreview())i=s(\"@geckos.io/server\").geckos;else{let l=s(\"fs\"),w=s(\"path\"),{app:p}=s(\"electron\"),{async:C}=await Promise.resolve().then(()=>xe(Ae())),{wrap:a}=await Promise.resolve().then(()=>xe(ct())),d=w.join(p.getPath(\"userData\"),\"geckos-server\"),m=w.join(d,\"index.js\");if(!l.existsSync(m)){let S=s(\"https\"),{https:{get:y}}=a({https:S}),{pipeline:D}=s(\"stream/promises\");console.info(\"Geckos server not found, downloading it now!\");let L=w.join(p.getPath(\"temp\"),\"geckos-server.zip\"),T=await new Promise(J=>y(\"https://s3.arthuro555.com/geckos-server-electron.zip\",P=>J(P)));await D(T,l.createWriteStream(L));let U=new C({file:L});l.mkdirSync(d,{recursive:!0}),await U.extract(null,d),await U.close()}i=s(m).geckos}if(!i)throw new Error(\"Geckos not found!\");this.server=i({label:\"THNK\"}),this.server.onConnection(l=>{let w=`${fe()}-${this.id++}-${fe()}`;this.onConnection(w),this.channels.set(w,l),l.onRaw(p=>this.onMessage(w,p)),l.onDisconnect(()=>{this.onDisconnection(w),this.channels.delete(w)})}),this.httpServer=s(\"http\").createServer(),this.server.addServer(this.httpServer),this.httpServer.listen(this.port);let c=l=>{l.returnValue=\"false\",this.close(),window.removeEventListener(\"beforeunload\",c),window.close()};window.addEventListener(\"beforeunload\",c)}close(){if(this.server&&this.httpServer){this.httpServer.close(),this.httpServer.closeAllConnections&&this.httpServer.closeAllConnections();for(let e of this.channels.values())e.close();this.channels.clear(),this.httpServer=null,this.server=null}}doSendMessageTo(e,t){let s=this.channels.get(e);s&&s.raw.emit(t.buffer.slice(t.buffer.byteLength-t.byteLength))}getServerID(){return this.serverID}};\n/**\n * @license node-stream-zip | (c) 2020 Antelle | https://github.com/antelle/node-stream-zip/blob/master/LICENSE\n * Portions copyright https://github.com/cthackers/adm-zip | https://raw.githubusercontent.com/cthackers/adm-zip/master/LICENSE\n */\n",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Hosts a THNK server on the local machine. Does not work on web or mobile builds.",
      "fullName": "Host a server (desktop only)",
      "functionType": "Action",
      "name": "HostServer",
      "sentence": "Host scene _PARAM2_ on a local server on port _PARAM1_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "THNK.server.startServer(",
            "    new THNK.GeckosServerAdapter(eventsFunctionContext.getArgument(\"Port\")),",
            "    runtimeScene,",
            "    eventsFunctionContext.getArgument(\"Scene\")",
            ");",
            ""
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [
        {
          "description": "The port to host the server on",
          "name": "Port",
          "type": "expression"
        },
        {
          "description": "The scene to start the server on.",
          "name": "Scene",
          "type": "sceneName"
        }
      ],
      "objectGroups": []
    }
  ],
  "eventsBasedBehaviors": [],
  "eventsBasedObjects": []
}